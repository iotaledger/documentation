# Message types

**In the Channels app, messages can be one of seven types, and each message contains [Protobuf3](../introduction/core-concepts.md#protobuf3-messaging) content that is specific to its type. This article describes what each message type is for and what fields it contains.**

## Announce

`Announce` messages are for announcing the start of a new channel.

These messages are sent by the channel author and contain information to allow subscribers to authenticate messages on the channel.

### Type header

`Announce` messages include the `STREAMS9CHANNEL9ANNOUNCE` type in the `signatureMessageFragment` field of the tail transaction.

### Content

The decoded message contents include the following fields.

|**Field**|**Description**|
|:--------|:---------------|
|`msspk` |The channel address|
|`empty` |Whether the channel accepts `Subscribe` and `Unsubscribe` messages|
|`ntrupk` |The author's NTRU public key (for subscribers to use in `Subscribe` messages)|
|`tag` | A hash value to be signed by the author|
|`sig`| The author's signature, which is generated by signing the hash value with an MSS private key|

### ChangeKey

`ChangeKey` messages are for informing subscribers of a new fork in the channel.

These messages are sent by the channel author and must be linked to either an `Announce` message or another `ChangeKey` message.

### Type header

`ChangeKey` messages include the `STREAMS9CHANNEL9CHANGEKEY` type in the `signatureMessageFragment` field of the tail transaction.

### Content

The decoded message contents include the following fields.

|**Field**|**Description**|
|:-------|:---------------|
|`msgid` |The message identifer of an `Announce` or `ChangeKey` message |
|`msspk` |The new channel address|
|`hash` |A hash value to be signed by the author|
|`sig_with_msspk` | The author's signature to prove ownership of the new fork in the channel|
|`sig_with_linked_msspk` |The author's signature to prove ownership of the channel |

### Keyload

`Keyload` messages are for sending session keys to subscribers to allow them to decrypt messages in `TaggedPacket` messages and `SignedPacket` messages. As well as session keys, these messages include a unique nonce, which allows the session keys to be reused.

These messages are sent by the channel author.

### Type header

`Keyload` messages include the `STREAMS9CHANNEL9KEYLOAD` type in the `signatureMessageFragment` field of the tail transaction.

### Content

The decoded message contents include the following fields.

|**Field**|**Description**|
|:-------|:---------------|
|`nonce` |A nonce to be used with the session key in the `ekey` field |
|`id` |Key identifier (whether it's a pre-shared key or an NTRU public key) |
|`psk` |The pre-shared key that is known to the author and to the subscribers|
|`ekey` | The session key|
|`sig`| An optional signature of the author to allow subscribers to authenticate the message|

## TaggedPacket

`TaggedPacket` messages are for sending encrypted or plain text messages on a channel.

These messages can be sent by both subscribers and authors.

If the message contains a masked message, it also includes a [message authentication code (MAC)](https://en.wikipedia.org/wiki/Message_authentication_code) to allow subscribers to authenticate the payload, using the session key from the previous `Keyload` message.

### Type header

`TaggedPacket` messages include the `STREAMS9CHANNEL9TAGGEDPACKET` type in the `signatureMessageFragment` field of the tail transaction.

### Content

The decoded message contents include the following fields.

|**Field**|**Description**|
|:-------|:---------------|
|`msgid` |The message identifer of the `Keyload` message that contains the session key|
|`public_payload` |A plain text message|
|`masked_payload` |A message that's encrypted with the session key in the referenced `Keyload` message|
|`mac` | MAC of the message|

### SignedPacket

`SignedPacket` messages are for sending encrypted or plain text messages that include the author's signature for authentication purposes.

These messages can be sent only by the channel author, who must first send an `Announce` or a `ChangeKey` message to link the `SignedPacket` message to.

### Type header

`SignedPacket` messages include the `STREAMS9CHANNEL9SIGNEDPACKET` type in the `signatureMessageFragment` field of the tail transaction.

### Content

The decoded message contents include the following fields.

|**Field**|**Description**|
|:-------|:---------------|
|`msgid` |The message identifer of the `Keyload` message that contains the session key|
|`public_payload` |A plain text message|
|`masked_payload` |A message that's encrypted with the session key in the referenced `Keyload` message|
|`hash` |A hash value to be signed by the author|
|`sig` | The author's signature to prove ownership of the channel|

### Subscribe

`Subscribe` messages are for subscribers to send the channel author their NTRU public keys so that they can do the following:

- Decrypt payloads in the `TaggedPacket` and `SignedPacket` messages
- Encrypt messages using the session key in the `Keyload` message

These messages can be sent only by subscribers.

To protect subscribers' identities, their NTRU public keys are encrypted, using the `unsubscribe_key`, which itself is encrypted with the author's NTRU public key so that only the channel author can decrypt it.

:::info:
Subscribers don't have signature keys, so they can't prove possesion of the NTRU private key with a signature. if author's wanted to establish such proof, they could do so outside of the channel.
:::

### Type header

`Subscribe` messages include the `STREAMS9CHANNEL9SUBSCRIBE` type in the `signatureMessageFragment` field of the tail transaction.

### Content

The decoded message contents include the following fields.

|**Field**|**Description**|
|:-------|:---------------|
|`msgid` |The message identifer of the `Announce` or `ChangeKey` message that contains the channel address|
|`unsubscribe_key` |Secret key that the subscriber can use to unsubscribe from the channel|
|`ntrupk` |The subscriber's encrypted NTRU public key|
|`mac` | MAC of the message|

### Unsubscribe

`Unsubscribe` messages are for subscribers to send the channel author their intent to unsubscribe from the channel.

These messages can be sent only by subscribers.

This message allows the author to make the `Keyload` messages smaller by not calculating and including the subscriber's session key in them.

Subscribers aren't forced to unsubscribe, however an honest subscriber would unsubscribe to save the author time and computational power.

|**Field**|**Description**|
|:-------|:---------------|
|`msgid` |The message identifer of the `Subscribe` message that the subscriber sent|
|`mac` | MAC of the message to prove ownership of the `unsubscribe_key` in the `Subscribe` message|
